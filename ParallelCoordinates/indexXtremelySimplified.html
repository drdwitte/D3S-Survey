<!DOCTYPE html>
<meta charset="utf-8">
<style>

svg {
  font: 12px sans-serif;
}

path.background {
  fill: none;
  stroke-width: 2;	
  shape-rendering: crispEdges;
}

path.foreground {
  fill: none;
  shape-rendering: crispEdges;
  stroke-width: 5;	
}



.axis line,
.axis path {
  fill: none;
  stroke: #000;
  shape-rendering: crispEdges;
}

.axis text {
  text-shadow: 0 1px 0 #fff, 1px 0 0 #fff, 0 -1px 0 #fff, -1px 0 0 #fff;
  cursor: move;
}

</style>
<body>
<script type="text/javascript" src="d3/d3.min.js"></script>

<script>

var margin = {top: 30, right: 30, bottom: 30, left: 30};
var width = 500; 
var height = 300; 


var skillset = ["Algorithms", "Math","Business"];


var filterMap = {
		"Algorithms":2,	
		"Math":2,
		"Business":1
}



var singleUser1 = {	
			"visible": true,	
			"skills":[
				{"type" : "Algorithms", "score" : 3},
				{"type" : "Math", "score" : 5},		
				{"type" : "Business", "score" : 1},
			]
		};
var singleUser2 = {	
			"visible": true,	
			"skills":[
				{"type" : "Algorithms", "score" : 3},
				{"type" : "Math", "score" : 3},		
				{"type" : "Business", "score" : 4},
			]
		};
var singleUser3 = {	
			"visible": false,	
			"skills":[
				{"type" : "Algorithms", "score" : 1},
				{"type" : "Math", "score" : 1},		
				{"type" : "Business", "score" : 3},
			]
		};



var xScale = d3.scale.ordinal()
	    		.domain(skillset)
	    		.rangeBands([margin.left,width-margin.bottom]);

var yScale = d3.scale.linear()
	    		.domain([0, 5.1])
	    		.range([height-margin.bottom,margin.top]);




var line = d3.svg.line();
var axis = d3.svg.axis().orient("left");


var svg = d3.select("body").append("svg")
    .attr("width", width)
    .attr("height", height)


d3.csv("skills2.csv", function(error, data) {


   console.log(data[0]);

   var filterCheck = filterSkills(data, filterMap);

   console.log(filterCheck.length);
   console.log(filterCheck[0]);

   var filteredData = []; 
   filteredData.push(singleUser1);	
   filteredData.push(singleUser2);	
   filteredData.push(singleUser3);	


  //drawing the X and Y-axis + add a caption
  var xAxis = d3.svg.axis()
			.scale(xScale)
			.orient("top")
				.ticks(skillset.length)
					;

  var yAxis = d3.svg.axis()
				.scale(yScale)
				.orient("left")
				.ticks(5)
				;



  var gX = svg.append("g");
  gX.attr("class","axis");
  gX.attr("transform","translate("
					+0
					+","
					+(margin.top)
					+")"
		);
  gX.call(xAxis);

	

  var gY = svg.append("g");
  gY.attr("class","axis");
  gY.attr("transform","translate("
					+margin.left
					+","
					+0
					+")"
			);
  gY.call(yAxis);



   //line function which extracts x,y coordinates of data point d + specifies how to interpolate	
   var lineFunc = d3.svg.line()
	  .x(function(d) {    return xScale(d.type)+xScale.rangeBand()/2; })
	  .y(function(d) {    return yScale(d.score); })
	  .interpolate('linear');

   for (i=0; i<filteredData.length; i++){
	
	drawLine(filteredData[i], lineFunc);	
   }
   i








 
});

   function drawLine(filteredData, lineFunc){

  	svg.append("path")
		  .attr('d', lineFunc(filteredData.skills))
		  .attr('stroke', function(data){ if (filteredData.visible){ return randRGB();} else {return "#ddd"}}) 
		  .attr('class',  function(data){ if (filteredData.visible){ return "foreground";} else {return "background"}}); 
   }



function randColor(){
	return parseInt(Math.random()*256);
}

function randRGB(){

	var rgbstring = "rgb("+randColor()+","+randColor()+","+randColor()+")";
	return rgbstring;
}

function filterSkills(records, filterM){
	console.log(records.length);
	
	var filtered = [];	
	for (i=0; i<records.length; i++){
		var ok = true;
		for (var skill in filterM) {
			console.log(skill)
  			if (filterM.hasOwnProperty(skill)) {
				if (records[i]["skills"][skill] < filterM[skill]){
					ok =false;
					break;
				}
			}

  		}
	
		var newRec = {};
		newRec["skills"] = records[i];
		newRec["visible"]=ok;
		filtered.push(newRec);

		console.log(newRec);
	}

	return filtered;
}

</script>

