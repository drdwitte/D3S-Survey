<!DOCTYPE html>
<meta charset="utf-8">
<style>

svg {
  font: 12px sans-serif;
}

path.background {
  fill: none;
  stroke-width: 1;	
  shape-rendering: crispEdges;
  opacity: 0.1;
}

path.foreground {
  fill: none;
  shape-rendering: crispEdges;
  stroke-width: 2;	
}



.axis line,
.axis path {
  fill: none;
  stroke: #000;
  shape-rendering: crispEdges;
}

.axis text {
  text-shadow: 0 1px 0 #fff, 1px 0 0 #fff, 0 -1px 0 #fff, -1px 0 0 #fff;
  cursor: move;
}

</style>
<body>
<script type="text/javascript" src="d3/d3.min.js"></script>

<script>

function convertCSV(csvObject, active){
	var converted = [];
	for (var i=0; i<csvObject.length; i++){
		converted.push(convertSingleRec(csvObject[i],active));	
	}
	return converted;
}

function convertSingleRec(record, active){

	var converted = {};
	converted["visible"]=false;
	converted["skills"] =[];
	for (var i=0; i<active.length; i++){
		var sc = record[active[i]];
		converted["skills"].push({type:active[i], score:sc});	
	}
	return converted;
	
}



function filterCompetence(records, filterM){

	var skills = Object.keys(filterM);

	var filtered = [];	
	for (var i=0; i<records.length; i++){
		var ok = true;
		for (var j=0; j<skills.length; j++) {
			if (records[i].skills[j].score < filterM[skills[j]]){
				ok =false;
				//console.log(records[i].skills[j].type+"_"+skills[j]);
				break;
				
			}
  		}
		records[i].visible=ok;
	}
}

/** INPUT PARAMETERS **/
//activeSkills is generated by forceLayout visualization
var activeSkills = ["FrontEnd", "BackEnd","DistributedData"];

//Algorithms	BackEnd	Bayesian	DistributedData	Business	ClassicalStats	DataWrangling	FrontEnd	GraphModels	MachineLearning	Math	Optimization	ProductDev	Science	Simulation	GIS	StructuredData	Marketing	SysAdmin	TimeSeries	UnstructuredData	Visualization


//generated by clicking on histogram bars
var filterMap = {
		"FrontEnd":3,	
		"BackEnd":3,
		"DistributedData":3
}

/** SETUP CANVAS **/

var margin = {top: 30, right: 30, bottom: 30, left: 30};
var width = 500; 
var height = 300; 

//create svg object
var svg = d3.select("body").append("svg")
    .attr("width", width)
    .attr("height", height)

//mappings from xy domain to pixel domain
var xScale = d3.scale.ordinal()
	    		.domain(activeSkills)
	    		.rangeBands([margin.left,width-margin.bottom]);

var yScale = d3.scale.linear()
	    		.domain([0, 5.1])
	    		.range([height-margin.bottom,margin.top]);

generateAxes();



//line function which extracts x,y coordinates of data point d + specifies how to interpolate	

var lineFunc = d3.svg.line()
  .x(function(d) {    return xScale(d.type)+xScale.rangeBand()/2; })
  .y(function(d) {    return yScale(d.score); })
  .interpolate('linear');



/*var exampleCSVData = [
	{"Algorithms":2,"Math":2,"Business":2,"ProducDev":3, "Science":2 },
	{"Algorithms":1,"Math":3,"Business":5,"ProducDev":5, "Science":1 },	
	{"Algorithms":5,"Math":4,"Business":1,"ProducDev":2, "Science":5 },
	{"Algorithms":5,"Math":3,"Business":1,"ProducDev":1, "Science":2 }
	];
*/
d3.csv("skills2.csv", function(data){

var convertedCSV = convertCSV(data, activeSkills);
filterCompetence(convertedCSV, filterMap);
for (var i=0; i<convertedCSV.length; i++){
	drawLine(convertedCSV[i], lineFunc);	
}

});














 


function drawLine(filteredData, lineFunc){

  	svg.append("path")
		  .attr('d', lineFunc(filteredData.skills))
		  .attr('stroke', function(data){ if (filteredData.visible){ return randRGB();} else {return "#ddd"}}) 
		  .attr('class',  function(data){ if (filteredData.visible){ return "foreground";} else {return "background"}}); 
}



function randColor(){
	return parseInt(Math.random()*256);
}

function randRGB(){

	var rgbstring = "rgb("+randColor()+","+randColor()+","+randColor()+")";
	return rgbstring;
}






function generateAxes(){
  //drawing the X and Y-axis + add a caption
  var xAxis = d3.svg.axis()
			.scale(xScale)
			.orient("top")
				.ticks(activeSkills.length)
					;

  var yAxis = d3.svg.axis()
				.scale(yScale)
				.orient("left")
				.ticks(5)
				;



  var gX = svg.append("g");
  gX.attr("class","axis");
  gX.attr("transform","translate("
					+0
					+","
					+(margin.top)
					+")"
		);
  gX.call(xAxis);

	

  var gY = svg.append("g");
  gY.attr("class","axis");
  gY.attr("transform","translate("
					+margin.left
					+","
					+0
					+")"
			);
  gY.call(yAxis);
}
</script>

